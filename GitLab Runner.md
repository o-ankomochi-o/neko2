GitLab ã§ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ï¼ˆCI/CD æ©Ÿèƒ½ï¼‰ã‚’ä½¿ã„ãŸã„å ´åˆã€åŸºæœ¬çš„ãªæµã‚Œã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚GitLab Runner ã¯ãã®ä¸­æ ¸ã¨ãªã‚‹å®Ÿè¡Œã‚¨ãƒ³ã‚¸ãƒ³ã§ã™ã€‚ä»¥ä¸‹ã§æ‰‹é †ã‚’èª¬æ˜ã—ã¾ã™ã€‚

---

## âœ… GitLab ã§ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’å‹•ã‹ã™åŸºæœ¬ã®æµã‚Œ

### 1. `.gitlab-ci.yml` ã‚’ä½œæˆã™ã‚‹

GitLab ã® CI/CD ã¯ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã«ã‚ã‚‹ `.gitlab-ci.yml` ãƒ•ã‚¡ã‚¤ãƒ«ã«å®šç¾©ã•ã‚ŒãŸæŒ‡ç¤ºã‚’å…ƒã«å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

#### ä¾‹:

```yaml
stages:
  - build
  - test
  - deploy

build-job:
  stage: build
  script:
    - echo "Building the app..."

test-job:
  stage: test
  script:
    - echo "Running tests..."

deploy-job:
  stage: deploy
  script:
    - echo "Deploying the app..."
```

---

### 2. GitLab Runner ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã™ã‚‹

GitLab Runner ã¯ã€ä¸Šè¨˜ã® CI ã‚¸ãƒ§ãƒ–ã‚’å®Ÿéš›ã«å®Ÿè¡Œã™ã‚‹ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã§ã™ã€‚GitLab.com ã§ã‚ã‚Œã°å…±æœ‰ãƒ©ãƒ³ãƒŠãƒ¼ãŒæä¾›ã•ã‚Œã¾ã™ãŒã€ã‚ªãƒ³ãƒ—ãƒ¬ã‚„è‡ªå‰ã‚µãƒ¼ãƒãƒ¼ã§ã¯è‡ªåˆ†ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ»ç™»éŒ²ãŒå¿…è¦ã§ã™ã€‚

#### ğŸ›  ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ‰‹é †ï¼ˆLinux ã®å ´åˆï¼‰:

```bash
# ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã¨ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
curl -L https://packages.gitlab.com/install/repositories/runner/gitlab-runner/script.deb.sh | sudo bash
sudo apt-get install gitlab-runner
```

#### ğŸ¯ ç™»éŒ²ã‚³ãƒãƒ³ãƒ‰:

```bash
sudo gitlab-runner register
```

**ç™»éŒ²æ™‚ã«èã‹ã‚Œã‚‹ã“ã¨ï¼š**

- GitLab ã® URL â†’ ä¾‹: `https://gitlab.example.com/`
- ç™»éŒ²ãƒˆãƒ¼ã‚¯ãƒ³ â†’ GitLab ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š > CI/CD > Runners ã§ç¢ºèª
- èª¬æ˜ãƒ©ãƒ™ãƒ« â†’ ä¾‹: `my-runner`
- Executorï¼ˆå®Ÿè¡Œæ–¹å¼ï¼‰â†’ ä¾‹: `shell`, `docker`, `virtualbox` ãªã©

  - æœ€ã‚‚ã‚ˆãä½¿ã‚ã‚Œã‚‹ã®ã¯ `shell` ã‚„ `docker`

---

### 3. `.gitlab-ci.yml` ã‚’ãƒªãƒã‚¸ãƒˆãƒªã« Push ã™ã‚‹

ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ«ãƒ¼ãƒˆã«è¿½åŠ ã—ã¦ã€GitLab ã« Push ã™ã‚Œã°ã€è‡ªå‹•çš„ã«ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãŒèµ°ã‚Šã¾ã™ã€‚

---

## ğŸ’¡ è£œè¶³ï¼šDocker Executor ã‚’ä½¿ã†å ´åˆã®ä¾‹

ã‚‚ã— Docker ã‚’ä½¿ã„ãŸã„ãªã‚‰ã€`register`æ™‚ã« Executor ã¨ã—ã¦`docker`ã‚’é¸ã³ã¾ã™ã€‚ãã®å¾Œã€`.gitlab-ci.yml` ã«ã“ã‚“ãªè¨˜è¿°ã‚’ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

```yaml
image: python:3.10

stages:
  - test

test-job:
  stage: test
  script:
    - python --version
    - pip install -r requirements.txt
    - pytest
```

---

## ğŸ” ã‚ˆãã‚ã‚‹è³ªå•

| è³ªå•                                        | å›ç­”                                                                           |
| ------------------------------------------- | ------------------------------------------------------------------------------ |
| GitLab.com ã‚’ä½¿ã£ã¦ã‚‹ã‘ã© Runner ãŒè¦ã‚‹ã®ï¼Ÿ | ã„ã„ãˆã€GitLab.com ã«ã¯ç„¡æ–™ã§ä½¿ãˆã‚‹**å…±æœ‰ Runner**ãŒã‚ã‚Šã¾ã™ï¼ˆãŸã ã—åˆ¶é™ã‚ã‚Šï¼‰ |
| GitLab CEï¼ˆã‚ªãƒ³ãƒ—ãƒ¬ï¼‰ã‚’ä½¿ã£ã¦ã„ã‚‹           | è‡ªå‰ã§ Runner ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒ**å¿…é ˆ**ã§ã™                                     |
| è¤‡æ•°ã® Runner ã‚’ä½¿ã„ãŸã„                    | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå˜ä½ã§ Runner ã‚’ç™»éŒ²ã—ã€`tags:` ã‚’ä½¿ã£ã¦åˆ¶å¾¡ã§ãã¾ã™               |

---

å¿…è¦ã§ã‚ã‚Œã°ã€OS ã‚„ GitLab ã®ã‚¨ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ï¼ˆGitLab.com / CE / EEï¼‰ã€ä½¿ç”¨ã—ãŸã„ Executorï¼ˆä¾‹ï¼šDockerï¼‰ãªã©ã‚‚æ•™ãˆã¦ã„ãŸã ã‘ã‚Œã°ã€ã‚ˆã‚Šå…·ä½“çš„ãªèª¬æ˜ã‚’ã—ã¾ã™ã€‚
ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€å‰æã‚’å…±æœ‰ã—ã¦ã„ãŸã ãåŠ©ã‹ã‚Šã¾ã™ã€‚
ã‚ªãƒ³ãƒ—ãƒ¬ãƒŸã‚¹ç‰ˆã® GitLabï¼ˆGitLab CE/EEï¼‰ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹å ´åˆã€**GitLab Runner**ã®ç†è§£ã¨å°å…¥ãŒä¸å¯æ¬ ã§ã™ã€‚

---

## ğŸƒ GitLab Runner ã¨ã¯ï¼Ÿ

### ğŸ”§ ä¸€è¨€ã§ã„ã†ã¨ï¼š

**GitLab CI/CD ã®ã‚¸ãƒ§ãƒ–ï¼ˆãƒ“ãƒ«ãƒ‰ãƒ»ãƒ†ã‚¹ãƒˆãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤ãªã©ï¼‰ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã®ã‚¨ãƒ³ã‚¸ãƒ³ï¼ˆå®Ÿè¡Œç’°å¢ƒï¼‰ã§ã™ã€‚**

GitLab ã« `.gitlab-ci.yml` ã‚’ç½®ãã¨ã€ãã“ã«å®šç¾©ã•ã‚ŒãŸã‚¸ãƒ§ãƒ–ã‚’ **GitLab Runner** ãŒå—ã‘å–ã‚Šã€å®Ÿéš›ã«ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã‚Œã¾ã™ã€‚

---

## ğŸ“¦ å…·ä½“çš„ã«ã§ãã‚‹ã“ã¨

| æ©Ÿèƒ½           | èª¬æ˜                                                                   |
| -------------- | ---------------------------------------------------------------------- |
| ã‚¸ãƒ§ãƒ–å®Ÿè¡Œ     | `build`, `test`, `deploy` ãªã©ã®å‡¦ç†ã‚’è‡ªå‹•ã§å®Ÿè¡Œ                       |
| ç’°å¢ƒã®åˆ‡ã‚Šæ›¿ãˆ | Dockerã€ã‚·ã‚§ãƒ«ï¼ˆLinux ã‚³ãƒãƒ³ãƒ‰ï¼‰ã€SSH æ¥ç¶šãªã©æ§˜ã€…ãª Executor ãŒä½¿ãˆã‚‹ |
| ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆ | è¤‡æ•°å°ã® Runner ã‚’ä¸¦åˆ—ã«å‹•ã‹ã™ã“ã¨ã§ã‚¸ãƒ§ãƒ–ã®é«˜é€ŸåŒ–ãŒã§ãã‚‹             |
| è‡ªç”±ãªç®¡ç†     | ã‚ªãƒ³ãƒ—ãƒ¬ç’°å¢ƒã«å¥½ããªæ•°ã ã‘è¨­ç½®ãƒ»è¨­å®šã§ãã‚‹                             |

---

## ğŸ—ï¸ GitLab Runner ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³ï¼ˆç°¡ç•¥ï¼‰

```
GitLab Serverï¼ˆã‚ªãƒ³ãƒ—ãƒ¬ï¼‰
     â”‚
     â””â”€â†’ GitLab Runnerï¼ˆåˆ¥ãƒã‚·ãƒ³ or åŒä¸€ãƒã‚·ãƒ³ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼‰
             â”‚
             â”œâ”€ Shell executorï¼ˆãƒ­ãƒ¼ã‚«ãƒ«å®Ÿè¡Œï¼‰
             â”œâ”€ Docker executorï¼ˆã‚³ãƒ³ãƒ†ãƒŠã§å®Ÿè¡Œï¼‰
             â””â”€ SSH executorï¼ˆåˆ¥ãƒã‚·ãƒ³ã«SSHã—ã¦å®Ÿè¡Œï¼‰
```

---

## ğŸ–¥ï¸ GitLab Runner ã®å‹•ä½œä¾‹

ãŸã¨ãˆã° `.gitlab-ci.yml` ã«ã“ã†æ›¸ã„ãŸã¨ã—ã¾ã™ï¼š

```yaml
test-job:
  script:
    - echo "Hello"
    - echo "World"
```

ã“ã®ã‚¸ãƒ§ãƒ–ãŒç™ºç«ã™ã‚‹ã¨ã€**GitLab Runner ãŒä»¥ä¸‹ã‚’ã‚„ã‚Šã¾ã™ï¼š**

1. GitLab ã‹ã‚‰ã‚¸ãƒ§ãƒ–ã‚’å—ã‘å–ã‚‹
2. æŒ‡å®šã•ã‚ŒãŸã‚³ãƒãƒ³ãƒ‰ï¼ˆ`echo`ï¼‰ã‚’é †ç•ªã«å®Ÿè¡Œ
3. çµæœã‚’ GitLab ã«å ±å‘Šï¼ˆæˆåŠŸ / å¤±æ•—ï¼‰

---

## âš™ï¸ GitLab Runner ã® Executor ã¨ã¯ï¼Ÿ

GitLab Runner ã¯ã€Œã©ã†ã‚„ã£ã¦ã‚¸ãƒ§ãƒ–ã‚’å®Ÿè¡Œã™ã‚‹ã‹ã€ã‚’ **Executor** ã¨ã„ã†ä»•çµ„ã¿ã§é¸ã¹ã¾ã™ã€‚

| Executor     | èª¬æ˜                              | ã‚ˆãä½¿ã‚ã‚Œã‚‹ç”¨é€”                         |
| ------------ | --------------------------------- | ---------------------------------------- |
| `shell`      | ãƒ›ã‚¹ãƒˆ OS ä¸Šã§ç›´æ¥å®Ÿè¡Œ            | ã‚·ãƒ³ãƒ—ãƒ«ãªæ§‹æˆã«æœ€é©                     |
| `docker`     | Docker ã‚³ãƒ³ãƒ†ãƒŠå†…ã§å®Ÿè¡Œ           | ã‚¯ãƒªãƒ¼ãƒ³ãªç’°å¢ƒã€ä¾å­˜é–¢ä¿‚ã‚’éš”é›¢ã—ãŸã„ã¨ã |
| `ssh`        | SSH å…ˆã§å®Ÿè¡Œ                      | åˆ¥ãƒã‚·ãƒ³ã‚’ä½¿ã£ã¦åˆ†æ•£å®Ÿè¡Œã—ãŸã„å ´åˆ       |
| `kubernetes` | K8s ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ä¸Šã§ Pod ã¨ã—ã¦å®Ÿè¡Œ | å¤§è¦æ¨¡é‹ç”¨ã«æœ€é©                         |

---

## ğŸª› ã‚ªãƒ³ãƒ—ãƒ¬ç’°å¢ƒã§ã®ä½¿ã„æ–¹ï¼ˆæ¦‚è¦ï¼‰

1. GitLab Runner ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆã‚ªãƒ³ãƒ—ãƒ¬ GitLab ã¨ã¯åˆ¥ã®ãƒã‚·ãƒ³ã§ã‚‚ OKï¼‰
2. GitLab ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è¨­å®šã‹ã‚‰ Runner ç™»éŒ²ç”¨ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—
3. Runner ã‚’ç™»éŒ²ï¼ˆ`gitlab-runner register` ã‚³ãƒãƒ³ãƒ‰ï¼‰
4. `.gitlab-ci.yml` ã‚’ä½œæˆãƒ»Push
5. CI/CD ãŒè‡ªå‹•å®Ÿè¡Œã•ã‚Œã‚‹

---

## ğŸ“ è£œè¶³ï¼šGitLab Runner ã¯ GitLab ã¨ã¯åˆ¥ã‚½ãƒ•ãƒˆ

GitLab æœ¬ä½“ã¨ GitLab Runner ã¯**åˆ¥ãƒ—ãƒ­ã‚»ã‚¹ / åˆ¥ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**ã§ã™ã€‚
GitLab ã¯ CI/CD ã®ã‚¸ãƒ§ãƒ–ã‚’**æŒ‡ç¤ºã™ã‚‹å´**ã€Runner ã¯**å®Ÿè¡Œã™ã‚‹å´**ã®å½¹å‰²ã§ã™ã€‚

---

## ğŸ§© ã¾ã¨ã‚

| é …ç›®     | å†…å®¹                                                |
| -------- | --------------------------------------------------- |
| ä½•ã‹     | GitLab ã® CI/CD æ©Ÿèƒ½ã‚’**å®Ÿéš›ã«å‹•ã‹ã™ã‚¨ãƒ³ã‚¸ãƒ³**      |
| å¿…è¦æ€§   | ã‚ªãƒ³ãƒ—ãƒ¬ GitLab ã‚’ä½¿ã£ã¦ CI/CD ã‚’å‹•ã‹ã™ã«ã¯**å¿…é ˆ** |
| ä½¿ã„æ–¹   | GitLab ã‚µãƒ¼ãƒãƒ¼ã¨ã¯åˆ¥é€”ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ç™»éŒ²         |
| å®Ÿè¡Œæ–¹æ³• | Shell, Docker, SSH ãªã©æŸ”è»Ÿã«é¸ã¹ã‚‹                 |

---

ã‚‚ã—ã€Œå®Ÿéš›ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹æµã‚Œã‚’ã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—ã§è¦‹ãŸã„ã€ãªã©ã‚ã‚Šã¾ã—ãŸã‚‰ã€æ¬¡ã«ãã¡ã‚‰ã‚’èª¬æ˜ã§ãã¾ã™ã€‚ã©ã†ã—ã¾ã™ã‹ï¼Ÿ
ã„ã„è³ªå•ã§ã™ï¼çµè«–ã‹ã‚‰è¨€ã†ã¨ï¼š

> **GitLab æœ¬ä½“ã¨ GitLab Runner ã¯ã€ŒåŒã˜ Docker ä¸Šã€ã«ä½œã£ã¦ã‚‚ OK ã§ã™ãŒã€ã€Œåˆ¥ã®ã‚³ãƒ³ãƒ†ãƒŠã€ã¨ã—ã¦ä½œã‚Šã¾ã™ã€‚**

ã¤ã¾ã‚Šã“ã†ãªã‚Šã¾ã™ï¼š

```
[EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹]
â”œâ”€â”€ Docker
â”‚   â”œâ”€â”€ gitlabï¼ˆGitLabæœ¬ä½“ã®ã‚³ãƒ³ãƒ†ãƒŠï¼‰
â”‚   â””â”€â”€ gitlab-runnerï¼ˆGitLab Runnerã®ã‚³ãƒ³ãƒ†ãƒŠï¼‰â†ä»Šã‹ã‚‰ä½œã‚‹ã®ã¯ã“ã‚Œ
```

---

## ğŸ§± Docker åˆå¿ƒè€…å‘ã‘ã«å›³ã§èª¬æ˜

### Docker ã¨ã¯ï¼Ÿ

EC2 ä¸Šã«ä»®æƒ³ã®ã€Œç®±ï¼ˆï¼ã‚³ãƒ³ãƒ†ãƒŠï¼‰ã€ã‚’ä½•å€‹ã‚‚ç«‹ã¦ã¦ã€ãã‚Œãã‚Œã«ã‚¢ãƒ—ãƒªã‚’å…¥ã‚Œã¦å®Ÿè¡Œã§ãã‚‹æŠ€è¡“ã§ã™ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ EC2ï¼ˆUbuntuãªã©ï¼‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€ Docker Engine â”€â”€â”€â”€â”€â”                    â”‚
â”‚   â”‚                        â”‚                    â”‚
â”‚   â”‚  ã‚³ãƒ³ãƒ†ãƒŠâ‘ : GitLab     â”‚ â† Gitã®ã‚µãƒ¼ãƒæœ¬ä½“     â”‚
â”‚   â”‚  ã‚³ãƒ³ãƒ†ãƒŠâ‘¡: GitLab Runner â”‚ â† CI/CDã‚’å‹•ã‹ã™ã‚„ã¤ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ… ãªãœåˆ†ã‘ã‚‹ã®ï¼Ÿ

- GitLab æœ¬ä½“ã¨ Runner ã¯åˆ¥ã®å½¹å‰²
- å¿…è¦ã«å¿œã˜ã¦ Runner ã‚’è¤‡æ•°ã«å¢—ã‚„ã›ã‚‹ï¼ˆã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£ï¼‰
- GitLab ãŒè½ã¡ã¦ã‚‚ã€Runner ã®æ§‹æˆã‚’ç¶­æŒã§ãã‚‹

---

## ğŸš€ ã‚„ã‚‹ã“ã¨ã®ã¾ã¨ã‚

1. **GitLab æœ¬ä½“** â†’ ã™ã§ã« Docker ã§èµ·å‹•æ¸ˆã¿
2. **GitLab Runner** â†’ Docker ã§ã‚‚ã† 1 å€‹ã‚³ãƒ³ãƒ†ãƒŠã‚’ä½œã£ã¦ç™»éŒ²ã™ã‚‹ï¼ˆ`docker run ...`ï¼‰
3. GitLab ã® Web ç”»é¢ã‹ã‚‰ Runner ãŒç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª

---

## ğŸ’¡ è£œè¶³ï¼šåŒã˜ã€ŒDocker ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã€ã«ã™ã‚‹æ–¹æ³•ã‚‚ã‚ã‚‹ï¼ˆå¿œç”¨ï¼‰

ã‚‚ã— GitLab æœ¬ä½“ã®ã‚³ãƒ³ãƒ†ãƒŠåãŒ `gitlab` ã§ã€åŒã˜ Docker ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«ã—ã¦ã„ã‚Œã° `http://gitlab` ã®ã‚ˆã†ã«åå‰ã§é€šä¿¡ã§ãã¾ã™ã€‚
ãŸã ã€æœ€åˆã¯ EC2 ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IPï¼ˆä¾‹: `http://13.112.xx.xx`ï¼‰ã§è¨­å®šã—ãŸæ–¹ãŒã‚ã‹ã‚Šã‚„ã™ã„ã§ã™ã€‚

---

ã‚‚ã—ã€ŒDocker Compose ã§ GitLab + GitLab Runner ã‚’ä¸€æ‹¬ç®¡ç†ã—ãŸã„ã€ã¨ã„ã†è¦æœ›ãŒã‚ã‚Œã°ã€ãã‚Œã‚‚å¯èƒ½ã§ã™ã€‚å¿…è¦ã«å¿œã˜ã¦æ§‹æˆä¾‹ã‚’ãŠå‡ºã—ã—ã¾ã™ã€‚

> ã¾ãšã¯ã“ã®ã€Œåˆ¥ã‚³ãƒ³ãƒ†ãƒŠã§ GitLab Runner ã‚’ä½œã‚‹æ–¹æ³•ã€ã‹ã‚‰å§‹ã‚ã‚‹ã®ãŒå®‰å¿ƒã§ã™ã‚ˆï¼

æ°—ã«ãªã‚‹ç”¨èªãŒã‚ã‚Œã°ä½•ã§ã‚‚èã„ã¦ãã ã•ã„ï¼
GitLab Runner ã¯ GitLab ã® CI/CD ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’å‹•ã‹ã™ãŸã‚ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã§ã™ã€‚
EC2 ä¸Šã« GitLab æœ¬ä½“ã‚’ç«‹ã¦ãŸå¾Œã¯ã€**GitLab Runner ã‚’åˆ¥ã‚³ãƒ³ãƒ†ãƒŠã¾ãŸã¯ãƒ›ã‚¹ãƒˆä¸Šã«æ§‹ç¯‰ã—ã¦ç™»éŒ²**ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

---

## âœ… å‰ææ¡ä»¶

- GitLab æœ¬ä½“ãŒ EC2 ä¸Šã® Docker ã§ç¨¼åƒä¸­
- GitLab ã«ãƒ­ã‚°ã‚¤ãƒ³ã§ãã€ç®¡ç†è€… or ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ Maintainer æ¨©é™ãŒã‚ã‚‹
- ãƒãƒ¼ãƒˆ `80` ã¾ãŸã¯ `443` ãŒé–‹ã„ã¦ã„ã¦ã€GitLab ã«å¤–éƒ¨ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹

---

## ğŸ§± ã‚¹ãƒ†ãƒƒãƒ— 1: GitLab Runner ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

### âœ… æ–¹æ³• â‘ ï¼šDocker ä¸Šã« GitLab Runner ã‚’æ§‹ç¯‰ï¼ˆæ¨å¥¨ï¼‰

```bash
docker run -d --name gitlab-runner --restart always \
  -v /srv/gitlab-runner/config:/etc/gitlab-runner \
  -v /var/run/docker.sock:/var/run/docker.sock \
  gitlab/gitlab-runner:latest
```

---

## ğŸ”‘ ã‚¹ãƒ†ãƒƒãƒ— 2: Runner ã‚’ GitLab ã«ç™»éŒ²

æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã§ GitLab ã«æ¥ç¶šãƒ»ç™»éŒ²ã—ã¾ã™ï¼š

```bash
docker exec -it gitlab-runner gitlab-runner register
```

### å¯¾è©±å½¢å¼ã§ä»¥ä¸‹ã‚’å…¥åŠ›ï¼š

| è³ªå•                                  | å›ç­”ä¾‹                                                                                |
| ------------------------------------- | ------------------------------------------------------------------------------------- |
| `Enter the GitLab instance URL:`      | `http://<ã‚ãªãŸã®GitLabã®URL>` ä¾‹: `http://<EC2ã®IP>`                                 |
| `Enter the registration token:`       | GitLab ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ > \[Settings] > \[CI/CD] > \[Runners] ã«ã‚ã‚‹ Registration Token |
| `Enter a description for the runner:` | `docker-runner`ï¼ˆä»»æ„ï¼‰                                                               |
| `Enter tags for the runner:`          | `docker`ï¼ˆä»»æ„ï¼‰                                                                      |
| `Enter executor:`                     | `docker`                                                                              |
| `Enter the default Docker image:`     | `python:3.10`ï¼ˆä¾‹ï¼‰                                                                   |

---

## ğŸ”„ ã‚¹ãƒ†ãƒƒãƒ— 3: ç™»éŒ²ç¢ºèª

GitLab ã® Web UI â†’ å¯¾è±¡ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ â†’ \[Settings] â†’ \[CI/CD] â†’ Runners ã®é …ç›®ã§ã€ã€Œç™»éŒ²æ¸ˆã¿ã® Runnerã€ã¨ã—ã¦è¡¨ç¤ºã•ã‚Œã¦ã„ã‚Œã° OK ã§ã™ã€‚

---

## ğŸ›  `.gitlab-ci.yml` ã®ä¾‹

GitLab CI ã‚’å‹•ã‹ã™ã«ã¯ `.gitlab-ci.yml` ã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ«ãƒ¼ãƒˆã«ç½®ãã¾ã™ã€‚

ä¾‹ï¼šPython ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ†ã‚¹ãƒˆç”¨

```yaml
image: python:3.10

stages:
  - test

test:
  stage: test
  script:
    - pip install -r requirements.txt
    - pytest
```

---

## ğŸ§¼ è£œè¶³ãƒ»Tips

| ãƒˆãƒ©ãƒ–ãƒ«                         | è§£æ±ºæ–¹æ³•                                                         |
| -------------------------------- | ---------------------------------------------------------------- |
| `Runner is stuck` ã¨è¡¨ç¤ºã•ã‚Œã‚‹   | GitLab ã«æ¥ç¶šã§ãã¦ã„ãªã„ï¼Runner ãŒå†èµ·å‹•ä¸­ã®å¯èƒ½æ€§             |
| `registration token`ãŒã‚ã‹ã‚‰ãªã„ | GitLab ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ > \[Settings] > \[CI/CD] > \[Runners] ã§ç¢ºèª |
| Docker in Docker ã‚’ä½¿ã„ãŸã„      | `privileged = true` ã«è¨­å®šãŒå¿…è¦ï¼ˆè¦ç›¸è«‡ï¼‰                       |

---

## ğŸ§° å‚è€ƒã‚³ãƒãƒ³ãƒ‰

```bash
# Runnerã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª
docker exec -it gitlab-runner gitlab-runner status

# Runner ã®ãƒ­ã‚°ç¢ºèª
docker logs gitlab-runner

# Runner å†ç™»éŒ²
docker exec -it gitlab-runner gitlab-runner unregister --all-runners
docker exec -it gitlab-runner gitlab-runner register
```

---

å¿…è¦ã«å¿œã˜ã¦ä»¥ä¸‹ã‚‚å¯¾å¿œå¯èƒ½ã§ã™ï¼š

- Docker executor ã®ä»£ã‚ã‚Šã« shell executor ã‚’ä½¿ã†æ–¹æ³•
- è¤‡æ•°ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ä½¿ãˆã‚‹å…±æœ‰ãƒ©ãƒ³ãƒŠãƒ¼ã®è¨­å®š
- è‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚° Runnerï¼ˆEC2 ã‚’ä½¿ã£ãŸ Runner ã® AutoScalingï¼‰

æ°—ã«ãªã‚‹ç‚¹ãŒã‚ã‚Œã°é æ…®ãªãèã„ã¦ãã ã•ã„ï¼
