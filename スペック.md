### EC2 で “Docker + GitLab (本体) + GitLab Runner” を動かす最小スペック早見表

| ユーザー規模 / 用途                                         | **インスタンス例**                                 | vCPU / RAM                        | 永続ストレージ (gp3) | 同居 Runner 並列数 | 期待できる動作                                                                                                   |
| ----------------------------------------------------------- | -------------------------------------------------- | --------------------------------- | -------------------- | ------------------ | ---------------------------------------------------------------------------------------------------------------- |
| **評価・個人検証**<br>(同時アクセス ≤5、リポジトリ ≤100 MB) | `t3.small`<br>`t4g.small`                          | 2 vCPU / **2 GB**<br>＋ SWAP 1 GB | 20 GB                | 1 ジョブ           | _GitLab は動くが体感もっさり。5 xx や再起動が起こる可能性_ ([docs.gitlab.com][1])                                |
| **超小規模チーム**<br>(\~5 人・軽量 CI)                     | `t3.medium` (汎用 Intel/AMD)<br>`t4g.medium` (Arm) | 2 vCPU / **4 GB**                 | 30–50 GB             | 1〜2 ジョブ        | 評価 + 軽い CI を一台完結で回せる“現実的な最小値”                                                                |
| **小規模プロダクト**<br>(10〜20 人・並列 CI 2〜3)           | `t3.large`                                         | 2 vCPU / **8 GB**                 | 50 GB 以上           | 2〜3 ジョブ        | GitLab 公式 “8 GB は最小、16 GB 推奨” の下限ギリギリだが、日常運用は可能 ([docs.gitlab.com][2], [gitlab.com][3]) |
| **余裕を持ちたい**<br>(20〜50 人・並列 CI 4〜5)             | `t3.xlarge`<br>`m7i-large`                         | 4 vCPU / **16 GB**                | 100 GB 以上          | 4〜5 ジョブ        | “標準構成” 入門。バックアップやメトリクスも安定                                                                  |

> **Runner を分離する場合**
> 本体：`t3.medium` 以上、Runner：`t3.small` 以上（ジョブ 1 並列 / 軽量ビルド想定）。

---

## なぜ “2 GB / 4 GB / 8 GB” が境目？

1. **公式ドキュメント**
   _メモリ制限環境_ ガイドでは **2 GB + SWAP** を最少値として示し “開発 5 人以下なら動く” と明言。([docs.gitlab.com][1])
2. **通常要件**
   GitLab 17.x 公式要件は “**8 GB (最小) / 16 GB (推奨)**”。20 RPS ≈ 1000 ユーザー規模を想定した値で、小規模ならもう少し削れる。([docs.gitlab.com][2], [gitlab.com][3])
3. **CPU クレジット型 (t 系) の罠**

   - `t3.*` はバースト時 100 % だがクレジットが尽きると 20–40 % に制限。
   - 長時間 CI を回す場合は **`t3a` より `m` シリーズ**を検討。

---

## スペック縮小時の “延命テクニック”

| ボトルネック           | 軽減策                                                                                  |
| ---------------------- | --------------------------------------------------------------------------------------- |
| **メモリ不足**         | `swapiness=10`＋ 1 GB SWAP、`gitlab.rb` に:<br>`postgresql['shared_buffers'] = '256MB'` |
| **CPU クレジット枯渇** | `t3.unlimited` 有効化 or `m7i` など定常性能インスタンス                                 |
| **I/O 遅延**           | gp3 + I/O 3000 IOPS 指定、SSD 系ボリューム必須                                          |
| **Runner が奪う資源**  | `concurrent = 1` にして同時実行を制限 / Runner 分離                                     |

---

## 最短セットアップ手順（例：t3.medium）

```bash
# ① Ubuntu 22.04 LTS, gp3 50GB, t3.medium で起動
# ② Docker & Compose
sudo apt update && sudo apt install -y docker.io docker-compose-plugin
# ③ 先の docker-compose.yml で GitLab 起動
sudo docker compose up -d
# ④ SWAP(1GB) を追加（任意）
sudo fallocate -l 1G /swap && sudo mkswap /swap && sudo swapon /swap
echo '/swap swap swap defaults 0 0' | sudo tee -a /etc/fstab
```

---

### まとめ

- **最少動作確認**だけなら **t3.small (2 GB+SWAP)** で可。
- **実務でストレスなく回す最低ライン**は **t3.medium (4 GB)**。
- **本格運用**は **t3.large (8 GB) 以上**、並列ビルドや監視込みなら **16 GB** を推奨。
- 余裕があれば **Runner を分離**してスケールしやすくするのが定石です。

[1]: https://docs.gitlab.com/omnibus/settings/memory_constrained_envs/?utm_source=chatgpt.com "Running GitLab in a memory-constrained environment"
[2]: https://docs.gitlab.com/install/requirements/?utm_source=chatgpt.com "GitLab installation requirements"
[3]: https://gitlab.com/gitlab-org/gitlab-foss/-/blob/v17.0.0/doc/install/requirements.md?utm_source=chatgpt.com "doc/install/requirements.md · v17.0.0 · undefined - GitLab"
