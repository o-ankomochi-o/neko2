`external_url 'http://your-ec2-public-ip'` に指定する **EC2 のパブリック IP アドレス** は、AWS マネジメントコンソールから簡単に確認できます。

---

## 🌐 パブリック IP の確認方法（AWS コンソール）

### ✅ 手順：

1. [AWS マネジメントコンソール](https://console.aws.amazon.com/) にログイン
2. 左上の検索バーで「EC2」と入力 → EC2 サービスを開く
3. 左メニューの「インスタンス」をクリック
4. 該当のインスタンス名をクリック
5. **概要タブ**の「パブリック IPv4 アドレス」欄を確認

   → 例：`3.115.XXX.XXX` のような数字列です

---

## 🧱 docker-compose.yml の書き方（例）

```yaml
environment:
  GITLAB_OMNIBUS_CONFIG: |
    external_url 'http://3.115.123.45'
```

> 💡 この IP アドレスをブラウザで開くと GitLab にアクセスできるようになります（起動後）

---

## 📌 補足

- **Elastic IP を使っている場合**も、Elastic IP がこの「パブリック IP」になります。
- **独自ドメインを使いたい場合**は、ここに `https://gitlab.example.com` などを指定します。
  もちろんです！**GitLab にアクセスできるように、EC2 のセキュリティグループで適切なポート（IP アドレス）を許可する方法**をわかりやすく説明します。

---

## 🔐 セキュリティグループとは？

> EC2 の“ファイアウォール”のようなもので、**どのポートに、どの IP からアクセスを許可するか**を制御します。

GitLab にアクセスするには、以下の 3 つのポートが**全て許可されている必要があります**：

| 用途        | ポート番号 | 説明                             |
| ----------- | ---------- | -------------------------------- |
| HTTP        | 80         | ブラウザでのアクセス（http\://） |
| HTTPS       | 443        | 暗号化アクセス（https\://）      |
| SSH（任意） | 22         | サーバーへのログイン用           |

---

## ✅ セキュリティグループの確認・変更手順

### ① EC2 インスタンスの画面へ

1. [AWS マネジメントコンソール](https://console.aws.amazon.com/) にログイン
2. サービス検索バーで「**EC2**」を検索 → クリック
3. 左メニュー「**インスタンス**」をクリック
4. 対象インスタンスをクリック

---

### ② セキュリティグループを確認

- 「**セキュリティ**」タブの中に「**セキュリティグループ**」という項目があります
- セキュリティグループ名をクリックして、設定画面に移動します

---

### ③ インバウンドルールを編集

1. 上部の「**インバウンドルールを編集**」をクリック
2. 以下のルールがなければ「ルールを追加」を押して追加します：

| タイプ | プロトコル | ポート範囲 | ソース            | 説明               |
| ------ | ---------- | ---------- | ----------------- | ------------------ |
| HTTP   | TCP        | 80         | 0.0.0.0/0         | 全世界に公開       |
| HTTPS  | TCP        | 443        | 0.0.0.0/0         | 全世界に公開       |
| SSH    | TCP        | 22         | 自分の IP（推奨） | SSH 用（EC2 接続） |

> ✅ SSH は「**自分の IP**」にするのがセキュリティ上安全です

3. 「**ルールを保存**」をクリック

---

## 🧪 接続テスト

セキュリティグループの設定後、以下を試します：

- `http://<パブリックIP>` にブラウザでアクセス（GitLab の画面が出るはず）
- `ssh -i your-key.pem ubuntu@<パブリックIP>` で EC2 にログイン

---

## 💡 補足

- `curl http://localhost` を EC2 内で実行して `200 OK` や HTML が返れば、GitLab は内部で動いています。
- ブラウザからアクセスできない場合、**セキュリティグループかファイアウォールの設定**が原因であることが多いです。
